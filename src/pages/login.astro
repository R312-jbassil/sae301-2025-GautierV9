---
import Layout from "../layouts/Layout.astro";
import Header from "../components/header.astro";
import Footer from "../components/footer.astro";
---

<Layout title="Connexion – TaVue">
  <Header />
  <div class="max-w-7xl mx-auto px-6 pt-12 mb-8">
  <div class="flex w-full gap-1 bg-[#E5E5E5]/80 rounded-xl p-1 shadow-sm">
    <a href="/login"
      class="flex-1 text-center py-3 rounded-xl font-semibold text-lg bg-white text-[#1E2A4A] shadow pointer-events-none"
      aria-current="page">
      Connexion
    </a>
    <a href="/"
      class="flex-1 text-center py-3 rounded-xl font-semibold text-lg text-[#B0B0B0] hover:bg-white hover:text-[#1E2A4A]">
      Inscription
    </a>
  </div>
</div>
  <section class="max-w-7xl mx-auto px-6 py-12 grid lg:grid-cols-2 gap-12 items-start">
  <div>
    <p class="uppercase tracking-wide text-[#B84651] font-semibold mb-2">Content de vous revoir</p>
    <h1 class="text-5xl font-extrabold mb-8 text-[#1E2A4A]">Connexion à votre compte</h1>
    <form id="login-form" class="flex flex-col gap-4 bg-white border border-[#E5E5E5] p-8 shadow rounded-lg" autocomplete="off">
      <label for="email" class="text-sm mb-1 text-[#B0B0B0]">Adresse email (utilisez celle de votre inscription)</label>
      <input name="email" id="email" type="email"
        class="input input-bordered w-full bg-[#F9F9F9] border border-[#E5E5E5] rounded-lg px-4 py-3 text-[#0A0A0A] placeholder:opacity-70 focus:border-[#1E2A4A] focus:ring-0"
        placeholder="Votre email" required />

      <label for="password" class="text-sm mb-1 text-[#B0B0B0]">Mot de passe (8 caractères minimum)</label>
      <input name="password" id="password" type="password"
        class="input input-bordered w-full bg-[#F9F9F9] border border-[#E5E5E5] rounded-lg px-4 py-3 text-[#0A0A0A] placeholder:opacity-70 focus:border-[#1E2A4A] focus:ring-0"
        placeholder="Mot de passe" required />

      <button type="submit"
        class="btn w-full mt-2 bg-[#1E2A4A] text-white font-semibold py-3 rounded-lg shadow hover:bg-[#162038] transition duration-150">
        Se connecter
      </button>
    </form>
    <div id="login-result" class="mt-4 text-sm text-[#B84651]"></div>
  </div>
</section>
  <Footer />

  <div id="login-success-modal" 
  style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(20,20,20,0.7); align-items:center; justify-content:center;">
  <div
    style="background:white; padding:4rem 6rem; border-radius:1.5rem; box-shadow:0 2px 32px rgba(0,0,0,0.2); text-align:center; width:75vw; max-width:920px; min-width:320px; margin:auto;">
    <h2 style="font-size:2.5rem; margin-bottom:1.5rem;">Connexion réussie !</h2>
    <p style="margin-bottom:2.5rem; font-size:1.35rem;">Vous êtes maintenant connecté.</p>
    <button id="go-configurator-login"
      style="background:#1E2A4A; color:white; font-weight:bold; padding:1rem 2.5rem; border:none; border-radius:0.8rem; font-size:1.25rem; cursor:pointer;">
      Continuer vers le configurateur
    </button>
  </div>
</div>

  <script>
    import pb from '../utils/pb'; // adapte le chemin selon ta structure

const form = document.getElementById('login-form');
const modal = document.getElementById('login-success-modal');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  try {
    // Auth avec pb.ts : met à jour pb.authStore
    await pb.collection('users').authWithPassword(email, password);

    form.reset();
    modal.style.display = "flex";
  } catch (err) {
    document.getElementById('login-result').textContent = err.message || "Erreur d’identification";
    console.log(err);
  }
});

// Pour la redirection sur bouton (inchangé)
document.addEventListener('click', function(e) {
  if (e.target && e.target.id === 'go-configurator-login') {
    window.location.href = "/configurateur";
  }
});
  </script>
</Layout>